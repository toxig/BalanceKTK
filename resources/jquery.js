(function(d){d.tiny=d.tiny||{};d.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:true,lockscroll:true,size:"auto",sizethumb:"auto"}};d.fn.tinyscrollbar=function(a){var b=d.extend({},d.tiny.scrollbar.options,a);this.each(function(){d(this).data("tsb",new c(d(this),b))});return this};d.fn.tinyscrollbar_update=function(a){return d(this).data("tsb").update(a)};function c(F,P){var L=this,C=F,M={obj:d(".viewport",F)},O={obj:d(".overview",F)},S={obj:d(".scrollbar",F)},J={obj:d(".track",S.obj)},G={obj:d(".thumb",S.obj)},K=P.axis==="x",I=K?"left":"top",A=K?"Width":"Height",E=0,a={start:0,now:0},H={},R=("ontouchstart" in document.documentElement)?true:false;function T(){L.update();D();return L}this.update=function(e){M[P.axis]=M.obj[0]["offset"+A];O[P.axis]=O.obj[0]["scroll"+A];O.ratio=M[P.axis]/O[P.axis];S.obj.toggleClass("disable",O.ratio>=1);J[P.axis]=P.size==="auto"?M[P.axis]:P.size;G[P.axis]=Math.min(J[P.axis],Math.max(0,(P.sizethumb==="auto"?(J[P.axis]*O.ratio):P.sizethumb)));S.ratio=P.sizethumb==="auto"?(O[P.axis]/J[P.axis]):(O[P.axis]-M[P.axis])/(J[P.axis]-G[P.axis]);E=(e==="relative"&&O.ratio<=1)?Math.min((O[P.axis]-M[P.axis]),Math.max(0,E)):0;E=(e==="bottom"&&O.ratio<=1)?(O[P.axis]-M[P.axis]):isNaN(parseInt(e,10))?E:parseInt(e,10);z()};function z(){var e=A.toLowerCase();G.obj.css(I,E/S.ratio);O.obj.css(I,-E);H.start=G.obj.offset()[I];S.obj.css(e,J[P.axis]);J.obj.css(e,J[P.axis]);G.obj.css(e,G[P.axis])}function D(){if(!R){G.obj.bind("mousedown",N);J.obj.bind("mouseup",B)}else{M.obj[0].ontouchstart=function(e){if(1===e.touches.length){N(e.touches[0]);e.stopPropagation()}}}if(P.scroll&&window.addEventListener){C[0].addEventListener("DOMMouseScroll",b,false);C[0].addEventListener("mousewheel",b,false)}else{if(P.scroll){C[0].onmousewheel=b}}}function N(e){var f=parseInt(G.obj.css(I),10);H.start=K?e.pageX:e.pageY;a.start=f=="auto"?0:f;if(!R){d(document).bind("mousemove",B);d(document).bind("mouseup",Q);G.obj.bind("mouseup",Q)}else{document.ontouchmove=function(g){g.preventDefault();B(g.touches[0])};document.ontouchend=Q}}function b(g){if(O.ratio<1){var e=g||window.event,f=e.wheelDelta?e.wheelDelta/120:-e.detail/3;E-=f*P.wheel;E=Math.min((O[P.axis]-M[P.axis]),Math.max(0,E));G.obj.css(I,E/S.ratio);O.obj.css(I,-E);if(P.lockscroll||(E!==(O[P.axis]-M[P.axis])&&E!==0)){e=d.event.fix(e);e.preventDefault()}}}function B(e){if(O.ratio<1){if(!R){a.now=Math.min((J[P.axis]-G[P.axis]),Math.max(0,(a.start+((K?e.pageX:e.pageY)-H.start))))}else{a.now=Math.min((J[P.axis]-G[P.axis]),Math.max(0,(a.start+(H.start-(K?e.pageX:e.pageY)))))}E=a.now*S.ratio;O.obj.css(I,-E);G.obj.css(I,a.now)}}function Q(){d(document).unbind("mousemove",B);d(document).unbind("mouseup",Q);G.obj.unbind("mouseup",Q);document.ontouchmove=document.ontouchend=null}return T()}}(jQuery));